(defn sys:map-indexing (world)
  (let map (.fetch world 'map))

  ; reset map data
  (.populate-blocked! map)
  (.clear-indexed-entities! map)

  ; iterate all positioned entities
  (for (entity, (pos)) in (query world, Position)
    (let idx (.xy-idx map [pos 'x] [pos 'y]))

    ; update blocking index, if the entity is blocking
    (let blocking (get-cmp world entity BlocksTile))
    (when blocking
      (.block-tile! map idx))

    ; index entities
    (.index-entity! map idx entity)))
